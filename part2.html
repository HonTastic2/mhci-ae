<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Tilt Menu</title>
    <link rel="stylesheet" href="style.css" />
    <script>
      let cursor = null;
      let cursor_height = 0;
      let bar_top = 0;
      let bar_height = 0;

      /*
       * Device orientation callback -- called each time sensor updates.
       */
      function callbackOrientation(event) {
        let alpha = event.alpha;
        let beta = event.beta;
        let gamma = event.gamma;

        document.getElementById("gyro_a").textContent = Math.floor(alpha);
        document.getElementById("gyro_b").textContent = Math.floor(beta);
        document.getElementById("gyro_g").textContent = Math.floor(gamma);

        let cursor_y = 0; // <---- Implement the menu scroll code here

        // Limit the cursor to the scrollbar coordinate space
        if (cursor_y < 0) {
          cursor_y = 0;
        } else if (cursor_y > (bar_height - cursor_height)) {
          cursor_y = bar_max - cursor_height;
        }

        // Reposition the cursor element in the window
        cursor.style.top = cursor_y;

        selectedMenuItem(-1); // <---- Implement menu item highlighting here

        // Update the cursor position debug text
        document.getElementById("cursor_y").textContent = Math.floor(cursor_y);
      }

      /*
       * Updates the menu to highlighted the selected menu item. Call this function
       * with a zero-indexed menu item number.
       */
      function selectedMenuItem(n) {
        let items = document.getElementsByClassName("menuitem");

        if (n < 0 || n >= items.length) {
          return;
        }

        for (var i = 0; i < items.length; i++) {
          if (i === n) {
            items[i].style.backgroundColor = "#26c6da";
          } else {
            items[i].style.backgroundColor = "#b2ebf2";
          }
        }
      }

      /*
       * Asks iOS 13+ users for permission to access device motion data.
       */
      function applePermissions() {
        if (DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === "function") {
          DeviceMotionEvent.requestPermission();
        }
      }

      /*
       * After the page has loaded, add our device motion event listener.
       */
      window.onload = function onLoad() {
        // Initialise menu elements
        cursor = document.getElementById("cursor");
        cursor_height = cursor.getBoundingClientRect().height;

        let scrollbar = document.getElementById("scrollbar");
        bar_top = scrollbar.getBoundingClientRect().top;
        bar_height = scrollbar.getBoundingClientRect().height;

        window.addEventListener("deviceorientation", callbackOrientation);
      };
    </script>
  </head>
  <body>
    <!-- Live display of sensor values -->
    <h1>Orientation</h1>
    <ul>
      <li>Alpha: <span id="gyro_a">0</span></li>
      <li>Beta: <span id="gyro_b">0</span></li>
      <li>Gamma: <span id="gyro_g">0</span></li>
    </ul>

    <!-- Tilt menu -->
    <h1>Menu</h1>
    <table id="menu">
      <tbody>
        <tr>
          <td id="scrollbar" rowspan="5">
            <div id="cursor" />
          </td>
          <td class="menuitem">Apple</td>
        </tr>
        <tr>
          <td class="menuitem">Banana</td>
        </tr>
        <tr>
          <td class="menuitem">Grapefruit</td>
        </tr>
        <tr>
          <td class="menuitem">Orange</td>
        </tr>
        <tr>
          <td class="menuitem">Peach</td>
        </tr>
        <tr>
          <td id="selectbar" colspan="2">
            <div id="selectcursor" />
          </td>
        </tr>
      </tbody>
    </table>

    <p>Cursor y coordinate: <span id="cursor_y">null</span></p>

    <!-- Trigger permissions popup on Apple devices -->
    <button onclick="applePermissions()">iOS Start</button>
  </body>
</html>
